#!/usr/bin/perl -w
#
# Passed a list of undocumented man pages, generates symlinks to
# undocumented.7.gz for those man pages.
#
# Also, it looks for debian/undocumented files for more lists of
# undocumented man pages.

use Debian::Debhelper::Dh_Lib;
init();

foreach $PACKAGE (@{$dh{DOPACKAGES}}) {
	$TMP=tmpdir($PACKAGE);
	$undocumented=pkgfile($PACKAGE,"undocumented");

	@undoc=();
	if ($undocumented) {
		@undoc=filearray($undocumented);
	}

	if (($PACKAGE eq $dh{FIRSTPACKAGE} || $dh{PARAMS_ALL}) && @ARGV) {
		push @undoc, @ARGV;
	}	

	foreach $file (@undoc) {
		$file=~s/.gz$//; # .gz extension is optional in input.

		# Determine what directory the file belongs in,
		# /usr/share/man, or /usr/X11R6/man, and how the link to
		# the undocuemtned.7 man page will look.
		($section)=$file=~m/^.*\.(\d)/;
		if (!$section) {
			error("\"$file\" does not have an extension.");
		}	
		if ($file=~/.*\.\dx/) {
			$dir="usr/X11R6/man/man$section";
			$reldir="../../../share/man/man7/";
		}
		elsif ($section != 7) {
			$dir="usr/share/man/man$section";
			$reldir="../man7/";
		}
		else {
			$dir="usr/share/man/man$section";
			$reldir="";
		}

		if (! -d "$TMP/$dir") {
			doit("install","-d","$TMP/$dir");
		}
		doit("ln","-sf","${reldir}undocumented.7.gz","$TMP/$dir/$file.gz");
	}
}
